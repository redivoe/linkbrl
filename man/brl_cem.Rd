% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/brl-cem.R, R/fs-brl-cem.R, R/graph-brl-cem.R
\name{brl_cem}
\alias{brl_cem}
\alias{fs_brl_cem}
\alias{graph_brl_cem}
\title{CEM estimation for bipartite record linkage models}
\usage{
brl_cem(
  X1,
  X2,
  model = c("fs", "graph"),
  reps = 5,
  complete_matching = FALSE,
  candidate_pairs = NULL,
  solver = "clp",
  ...
)

fs_brl_cem(
  X1,
  X2,
  a_prop = 2,
  b_prop = 2,
  max_iter = 50,
  eps = 1e-04,
  complete_matching = FALSE,
  candidate_pairs = NULL,
  comp_data = NULL,
  solver = "clp"
)

graph_brl_cem(
  X1,
  X2,
  a_prop = 2,
  b_prop = 2,
  a_beta = 1.5,
  b_beta = 5,
  theta_method = c("empirical", "uniform", "estimated"),
  max_iter = 50,
  eps = 1e-04,
  complete_matching = FALSE,
  candidate_pairs = NULL,
  comp_data = NULL,
  solver = "clp"
)
}
\arguments{
\item{X1, X2}{Matrices of the two categorical datasets to be linked.
Rows correspond to records and columns to linking variables.
Both must have the same variables in the same order.}

\item{model}{Character scalar used by \code{brl_cem()}:
\code{"fs"} selects the Fellegi–Sunter model,
\code{"graph"} selects the graphical record linkage model.}

\item{reps}{Integer. Number of repeated CEM fits in \code{brl_cem()}.}

\item{complete_matching}{Logical. If \code{FALSE} (default), an
at-most one-to-one matching is enforced (each record can be matched
at most once). If \code{TRUE}, an exactly one-to-one matching is
enforced on the smaller dataset (a complete bipartite matching).}

\item{candidate_pairs}{Optional integer matrix with two columns specifying
candidate record pairs to be considered for matching. Each row corresponds
to a pair \code{(i, j)}, where \code{i} indexes rows of \code{X1} and
\code{j} indexes rows of \code{X2} (both 1-based).
If \code{NULL} (default), all possible record pairs are considered.}

\item{solver}{Character string specifying the LP solver to be used by
\pkg{ROI}. Currently supported options are \code{"clp"} and
\code{"lpsolve"}. The default is \code{"clp"}; if the corresponding
plugin package \pkg{ROI.plugin.clp} is not available, a warning is
issued and the solver falls back to \code{"lpsolve"} (if available).
If \code{"lpsolve"} is requested explicitly, the package
\pkg{ROI.plugin.lpsolve} must be installed.}

\item{...}{Additional arguments passed to the selected fitting function when
using \code{brl_cem()}.}

\item{a_prop, b_prop}{Positive numeric scalars specifying Beta prior parameters
for the overlap proportion.}

\item{max_iter}{Integer. Maximum number of CEM iterations.}

\item{eps}{Numeric. Convergence tolerance on the increase in complete
log-likelihood.}

\item{comp_data}{Optional list of precomputed comparison data.}

\item{a_beta, b_beta}{Positive numeric scalars specifying Beta prior parameters
for the distortion probabilities.}

\item{theta_method}{Character scalar controlling how category probabilities
are handled in the graphical model. One of \code{"empirical"},
\code{"uniform"}, or \code{"estimated"}.}
}
\value{
Each routine returns a list containing:
\describe{
\item{Delta}{A sparse \code{TsparseMatrix} encoding the estimated bipartite
matching between records in \code{X1} and \code{X2}.}
\item{cloglik}{Numeric vector of complete data log-likelihood values across CEM
iterations.}
\item{prop}{Estimated overlap proportion of linked records.}
\item{coreferent_pairs}{Matrix with indices of the predicted coreferent pairs.}
\item{id_X2}{Integer vector of length \code{nrow(X2)} giving a predicted
unique identifier for each record in \code{X2}. The implied unique
identifiers for \code{X1} are \code{1:nrow(X1)}. Together, these
identifiers define a common linkage key that can be used to join
\code{X1} and \code{X2} after record linkage.}
\item{switched_order}{Logical; \code{TRUE} if the input datasets were swapped
internally because \code{nrow(X1) < nrow(X2)}.}
}

Model-specific outputs:
\itemize{
\item \code{fs_brl_cem()}: returns variable-specific agreement probabilities for
coreferent and non coreferent pairs \code{m} and \code{u}.
\item \code{graph_brl_cem()}: returns distortion probabilities \code{beta}
and category probabilities \code{theta}, and the chosen \code{theta_method}.
\item \code{brl_cem()}: additionally returns the number of runs of the CEM algorithm
(\code{reps}) and the number of failed runs (\code{error_reps}).
}
}
\description{
Fit bipartite record linkage models via a Classification EM (CEM)
algorithm. The matching problem is solved using
\pkg{ROI} with a linear programming backend.
}
\details{
Two models are supported:
\itemize{
\item \code{fs_brl_cem()}: the Fellegi–Sunter model (two-class latent model fitted to pairwise comparison data),
\item \code{graph_brl_cem()}: the graphical record linkage.
}
Both models use the \emph{fast beta linkage} (fabl) prior
for the matching structure.

The function \code{brl_cem()} is a wrapper that runs either model multiple
times and returns the fit with the highest final complete data log-likelihood.
}
\examples{
\dontrun{
# Fellegi–Sunter model
fit_fs <- fs_brl_cem(X1, X2, max_iter = 20)

# Graphical record linkage model
fit_graph <- graph_brl_cem(X1, X2, max_iter = 20)

# Repeated runs, best solution retained
fit_reps <- brl_cem(X1, X2, model = "graph", reps = 5, max_iter = 20)
}

}
\references{
Kundinger, B., Reiter, J. P., and Steorts, R. C. (2025).
\emph{Efficient and Scalable Bipartite Matching with Fast Beta Linkage (fabl)}.
Bayesian Analysis, 20(3), 949--972.
\doi{10.1214/24-BA1427}

Steorts, R. C., Hall, R., and Fienberg, S. E. (2016).
\emph{A Bayesian Approach to Graphical Record Linkage and Deduplication}.
Journal of the American Statistical Association, 111(516), 1660--1672.
\doi{10.1080/01621459.2015.1105807}
}
